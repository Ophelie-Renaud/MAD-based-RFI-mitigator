/**
 * @file Core0.c
 * @generated by CPrinter
 * @date Tue Jun 20 02:58:01 CEST 2023
 *
 * Code generated for processing element Core0 (ID=0).
 */

#include "preesm_gen.h"
// Core Global Declaration
extern pthread_barrier_t iter_barrier;
extern int preesmStopThreads;

#ifdef PREESM_MD5_UPDATE
extern struct rk_sema preesmPrintSema;
#endif

// Core Global Definitions
char Shared[1]; //  size:= 1*char
char *const Data_Acquisition_0__Median_Computation_0__0 = (char*) (Shared + 0); // Data_Acquisition_0 > Median_Computation_0 size:= 1*char
uchar *const raw_data_o__raw_data_i__0 = (uchar*) (Shared + 0); // Data_Acquisition_0_raw_data_o > Median_Computation_0_raw_data_i size:= 1*uchar

void* computationThread_Core0(void *arg) {
  if (arg != NULL) {
    printf("Warning: expecting NULL arguments\n");
    fflush (stdout);
  }

#ifdef PREESM_MD5_UPDATE
	PREESM_MD5_CTX preesm_md5_ctx_raw_data_o__raw_data_i__0;
	PREESM_MD5_Init(&preesm_md5_ctx_raw_data_o__raw_data_i__0);
#endif
  // Initialisation(s)
    printf("\nStart Core0\n");
  initDataAcq(); // Data_Acquisition_0

  // Begin the execution loop
  pthread_barrier_wait(&iter_barrier);
#ifdef PREESM_LOOP_SIZE // Case of a finite loop
	int index;
	for(index=0;index<PREESM_LOOP_SIZE && !preesmStopThreads;index++){
#else // Default case of an infinite loop
  while (!preesmStopThreads) {
#endif
    // loop body
    DataAcq(raw_data_o__raw_data_i__0); // Data_Acquisition_0

    MedianCpt(raw_data_o__raw_data_i__0); // Median_Computation_0
#ifdef PREESM_MD5_UPDATE
		PREESM_MD5_Update(&preesm_md5_ctx_raw_data_o__raw_data_i__0,(char *)raw_data_o__raw_data_i__0, 1);
		#endif

    // loop footer
    pthread_barrier_wait(&iter_barrier);
      preesmStopThreads = 1;
  }

#ifdef PREESM_MD5_UPDATE
	// Print MD5
	rk_sema_wait(&preesmPrintSema);
	unsigned char preesm_md5_chars_final[20] = { 0 };
	PREESM_MD5_Final(preesm_md5_chars_final, &preesm_md5_ctx_raw_data_o__raw_data_i__0);
	printf("preesm_md5_raw_data_o__raw_data_i__0 : ");
	for (int i = 16; i > 0; i -= 1){
		printf("%02x", *(preesm_md5_chars_final + i - 1));
	}
	printf("\n");
	fflush(stdout);
	rk_sema_post(&preesmPrintSema);
#endif

  return NULL;
}

